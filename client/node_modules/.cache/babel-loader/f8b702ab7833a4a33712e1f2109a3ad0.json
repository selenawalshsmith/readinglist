{"ast":null,"code":"import e, { useContext as t, createContext as r, useReducer as o, useState as n, useEffect as a } from \"react\";\nimport u from \"auth0-js\";\n\nfunction i() {\n  return (i = Object.assign || function (e) {\n    for (var t = 1; t < arguments.length; t++) {\n      var r = arguments[t];\n\n      for (var o in r) Object.prototype.hasOwnProperty.call(r, o) && (e[o] = r[o]);\n    }\n\n    return e;\n  }).apply(this, arguments);\n}\n\nvar s = function (e, t) {\n  switch (t.type) {\n    case \"login\":\n      var r = t.authResult,\n          o = t.user,\n          n = 1e3 * r.expiresIn + new Date().getTime();\n      return \"undefined\" != typeof localStorage && (localStorage.setItem(\"useAuth:expires_at\", JSON.stringify(n)), localStorage.setItem(\"useAuth:user\", JSON.stringify(o))), i({}, e, {\n        user: o,\n        expiresAt: n,\n        authResult: r\n      });\n\n    case \"logout\":\n      return \"undefined\" != typeof localStorage && (localStorage.removeItem(\"useAuth:expires_at\"), localStorage.removeItem(\"useAuth:user\")), i({}, e, {\n        user: {},\n        expiresAt: null,\n        authResult: null\n      });\n\n    case \"stopAuthenticating\":\n      return i({}, e, {\n        isAuthenticating: !1\n      });\n\n    case \"startAuthenticating\":\n      return i({}, e, {\n        isAuthenticating: !0\n      });\n\n    case \"error\":\n      return i({}, e, {\n        user: {},\n        expiresAt: null,\n        authResult: null,\n        errorType: t.errorType,\n        error: t.error\n      });\n\n    default:\n      return e;\n  }\n};\n\n\"undefined\" != typeof Symbol && (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))), \"undefined\" != typeof Symbol && (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\")));\n\nvar c = function (e) {\n  var t = e.err,\n      r = e.dispatch,\n      o = e.auth0,\n      n = e.authResult;\n\n  try {\n    return r({\n      type: \"stopAuthenticating\"\n    }), n && n.accessToken && n.idToken ? Promise.resolve(function (e, t) {\n      try {\n        var a = Promise.resolve(function (e) {\n          var t = e.dispatch,\n              r = e.auth0,\n              o = e.authResult;\n\n          try {\n            return Promise.resolve(new Promise(function (e, n) {\n              r.client.userInfo(o.accessToken || \"\", function (r, a) {\n                r ? (t({\n                  type: \"error\",\n                  errorType: \"userInfo\",\n                  error: r\n                }), n(r)) : (t({\n                  type: \"login\",\n                  authResult: o,\n                  user: a\n                }), e(a));\n              });\n            }));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        }({\n          dispatch: r,\n          auth0: o,\n          authResult: n\n        })).then(function () {\n          return !0;\n        });\n      } catch (e) {\n        return !1;\n      }\n\n      return a && a.then ? a.then(void 0, function () {\n        return !1;\n      }) : a;\n    }()) : t ? (console.error(t), r({\n      type: \"error\",\n      error: t,\n      errorType: \"authResult\"\n    }), Promise.resolve(!1)) : Promise.resolve(!1);\n  } catch (e) {\n    return Promise.reject(e);\n  }\n},\n    l = function () {\n  var e = t(p),\n      r = e.state,\n      o = e.dispatch,\n      n = e.auth0,\n      a = e.callback_domain,\n      u = e.navigate,\n      i = e.customPropertyNamespace,\n      s = function () {\n    return !!(r.expiresAt && new Date().getTime() < r.expiresAt);\n  };\n\n  return {\n    isAuthenticating: r.isAuthenticating,\n    isAuthenticated: s,\n    isAuthorized: function (e) {\n      var t = Array.isArray(e) ? e : [e],\n          o = r.user[(i + \"/user_metadata\").replace(/\\/+user_metadata/, \"/user_metadata\")];\n      return console.log({\n        _roles: t,\n        metadata: o,\n        customPropertyNamespace: i\n      }, r.user), !(!s() || !o) && t.some(function (e) {\n        return o.roles.includes(e);\n      });\n    },\n    user: r.user,\n    userId: r.user ? r.user.sub : null,\n    authResult: r.authResult,\n    login: function () {\n      n && n.authorize();\n    },\n    logout: function () {\n      n && n.logout({\n        returnTo: a\n      }), o({\n        type: \"logout\"\n      }), u(\"/\");\n    },\n    handleAuthentication: function (e) {\n      var t = (void 0 === e ? {} : e).postLoginRoute,\n          r = void 0 === t ? \"/\" : t;\n      \"undefined\" != typeof window && (o({\n        type: \"startAuthenticating\"\n      }), n && n.parseHash(function (e, t) {\n        try {\n          return Promise.resolve(c({\n            err: e,\n            authResult: t,\n            dispatch: o,\n            auth0: n\n          })).then(function () {\n            u(r);\n          });\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      }));\n    }\n  };\n};\n\nfunction h() {\n  var e = {};\n\n  if (\"undefined\" != typeof localStorage) {\n    var t = new Date(JSON.parse(localStorage.getItem(\"useAuth:expires_at\") || \"0\"));\n    t > new Date() && (e = {\n      user: JSON.parse(localStorage.getItem(\"useAuth:user\") || \"{}\"),\n      expiresAt: t\n    });\n  }\n\n  return i({}, {\n    user: {},\n    expiresAt: null,\n    isAuthenticating: !1\n  }, {}, e);\n}\n\nvar p = r({\n  state: h(),\n  dispatch: function () {},\n  auth0: null,\n  callback_domain: \"http://localhost:8000\",\n  customPropertyNamespace: \"http://localhost:8000\",\n  navigate: function (e) {}\n}),\n    m = function (t) {\n  var r = t.children,\n      l = t.navigate,\n      m = t.auth0_domain,\n      d = t.customPropertyNamespace,\n      f = \"undefined\" != typeof window ? window.location.protocol + \"//\" + window.location.host : \"http://localhost:8000\",\n      y = new u.WebAuth(i({}, {\n    domain: m,\n    clientID: t.auth0_client_id,\n    redirectUri: f + \"/auth0_callback\",\n    audience: \"https://\" + (t.auth0_audience_domain || m) + \"/api/v2/\",\n    responseType: \"token id_token\",\n    scope: \"openid profile email\"\n  }, {}, t.auth0_params)),\n      g = o(s, h()),\n      v = g[0],\n      A = g[1],\n      S = n({\n    state: v,\n    dispatch: A,\n    auth0: y,\n    callback_domain: f,\n    customPropertyNamespace: d,\n    navigate: l\n  }),\n      b = S[0],\n      _ = S[1];\n  return a(function () {\n    _(function (e) {\n      return i({}, e, {\n        state: v\n      });\n    });\n  }, [v]), a(function () {\n    A({\n      type: \"startAuthenticating\"\n    }), y.checkSession({}, function (e, t) {\n      A({\n        type: \"stopAuthenticating\"\n      }), console.log(e), e ? A({\n        type: \"error\",\n        errorType: \"checkSession\",\n        error: e\n      }) : c({\n        dispatch: A,\n        auth0: y,\n        authResult: t\n      });\n    });\n  }, []), e.createElement(p.Provider, {\n    value: b\n  }, r);\n};\n\nexport { m as AuthProvider, l as useAuth };","map":null,"metadata":{},"sourceType":"module"}